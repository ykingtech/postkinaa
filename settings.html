<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PostKinaa - ‡∑É‡∑ê‡∂ö‡∑É‡∑î‡∂∏‡∑ä</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        @keyframes fadeIn { from { opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }
        .fade-in { animation: fadeIn 0.5s ease-out; }
    </style>
</head>

<body class="min-h-screen">

    <header id="appHeader" class="bg-white/80 backdrop-blur-lg border-b border-purple-100 sticky top-0 z-50 shadow-sm">
        <div class="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
            
            <div class="flex items-center space-x-3">
                <button onclick="window.location.href='Home.html'" title="‡∂¥‡∑É‡∑î‡∂¥‡∑É‡∂ß"
                    class="p-2 text-xl text-gray-600 hover:text-purple-600 hover:bg-purple-100 rounded-full transition-colors">
                    ‚¨ÖÔ∏è
                </button>
                <h1 class="text-3xl font-bold bg-clip-text text-transparent" id="headerTitle">‚öôÔ∏è ‡∑É‡∑ê‡∂ö‡∑É‡∑î‡∂∏‡∑ä</h1>
            </div>

            <button onclick="signOutUser()"  
                class="px-3 py-1 bg-red-100 text-red-600 rounded-full text-sm font-semibold hover:bg-red-200 transition-colors">
                Logout
            </button>
        </div>
    </header>

    <div class="max-w-4xl mx-auto px-4 py-8">

        <div class="bg-white/90 backdrop-blur-lg rounded-3xl shadow-xl border border-blue-100 p-6 mb-8 fade-in">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">üëã ‡∂±‡∂∏ ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏</h2>
            <p class="text-sm text-gray-500 mb-3">Posts ‡∑Ä‡∂Ω‡∂Ø‡∑ì ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂± ‡∂î‡∂∂‡∂ú‡∑ö ‡∂±‡∂∏ ‡∂∏‡∑ô‡∂≠‡∂±‡∑í‡∂±‡∑ä ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.</p>
            <input id="newNameInput" type="text" placeholder="‡∂±‡∑Ä ‡∂±‡∂∏..." 
                class="w-full px-4 py-3 mb-4 bg-gray-50 rounded-xl border-2 border-transparent focus:border-blue-400 outline-none transition text-lg">
            
            <button onclick="updateUserName()"
                class="px-6 py-2 bg-blue-500 text-white rounded-full font-semibold hover:bg-blue-600 transition shadow-md">
                ‡∂±‡∂∏ ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
            </button>
        </div>

        <div class="bg-white/90 backdrop-blur-lg rounded-3xl shadow-xl border border-yellow-100 p-6 mb-8 fade-in">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">üñºÔ∏è Avatar (Emoji) ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏</h2>
            <p class="text-sm text-gray-500 mb-3">‡∂î‡∂∂‡∂ú‡∑ö Posts ‡∑É‡∑Ñ Profile ‡∑Ä‡∂Ω‡∂ß ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂± Emoji ‡∂ë‡∂ö ‡∂∏‡∑ô‡∂≠‡∂±‡∑í‡∂±‡∑ä ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.</p>
            <input id="newAvatarInput" type="text" maxlength="2" placeholder="‡∂±‡∑Ä Emoji (‡∂ã‡∂Ø‡∑è: ‚ú®)" 
                class="w-full px-4 py-3 mb-4 bg-gray-50 rounded-xl border-2 border-transparent focus:border-yellow-400 outline-none transition text-3xl text-center">
            
            <button onclick="updateUserAvatar()"
                class="px-6 py-2 bg-yellow-500 text-white rounded-full font-semibold hover:bg-yellow-600 transition shadow-md">
                Avatar ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
            </button>
        </div>
        <div class="bg-white/90 backdrop-blur-lg rounded-3xl shadow-xl border border-green-100 p-6 mb-8 fade-in">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">üìù Bio ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏</h2>
            <p class="text-sm text-gray-500 mb-3">‡∂î‡∂∂ ‡∂ú‡∑ê‡∂± ‡∂ö‡∑ô‡∂ß‡∑í ‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª‡∂∫‡∂ö‡∑ä ‡∂∏‡∑ô‡∑Ñ‡∑í ‡∂Ω‡∑í‡∂∫‡∂±‡∑ä‡∂± (Profile ‡∂ë‡∂ö‡∑ö ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂∫‡∑í).</p>
            <textarea id="newBioInput" rows="3" placeholder="‡∂î‡∂∂ ‡∂ú‡∑ê‡∂± ‡∂Ω‡∑í‡∂∫‡∂±‡∑ä‡∂±..." 
                class="w-full px-4 py-3 mb-4 bg-gray-50 rounded-xl border-2 border-transparent focus:border-green-400 outline-none transition text-base resize-none"></textarea>
            
            <button onclick="updateUserBio()"
                class="px-6 py-2 bg-green-500 text-white rounded-full font-semibold hover:bg-green-600 transition shadow-md">
                Bio ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
            </button>
        </div>
        <div class="bg-white/90 backdrop-blur-lg rounded-3xl shadow-xl border border-pink-100 p-6 mb-8 fade-in">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">üé® Theme ‡∂≠‡∑ù‡∂ª‡∂±‡∑ä‡∂± (Theme 10)</h2>
            <div id="themeContainer" class="grid grid-cols-2 md:grid-cols-5 gap-4">
                </div>
        </div>

        <div class="bg-white/90 backdrop-blur-lg rounded-3xl shadow-xl border border-purple-100 p-6 mb-8 fade-in">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">üëÄ ‡∂î‡∂∂‡∂ú‡∑ö Posts</h2>
            <div id="myPostsFeed" class="space-y-4 mt-6">
                <p id="loadingMyPosts" class="text-gray-500 text-center">‡∂î‡∂∂‡∂ú‡∑ö Posts Loading ‡∑Ä‡∑ô‡∂∏‡∑í‡∂±‡∑ä...</p>
                </div>
        </div>

        <div id="notificationBox" class="fixed bottom-5 left-1/2 -translate-x-1/2 bg-black text-white px-4 py-2 rounded-full shadow-xl text-sm z-50 hidden"></div>
    </div>

    <script>
    /* ============================================================
        üî• Firebase Config + Init
    ============================================================ */
    const firebaseConfig = {
        apiKey: "AIzaSyAzNJ-P8aAMvTuNWKcQYCjIIHiaL0BpdZ0",
        authDomain: "game-f1c21.firebaseapp.com",
        databaseURL: "https://game-f1c21-default-rtdb.firebaseio.com",
        projectId: "game-f1c21",
        storageBucket: "game-f1c21.firebasestorage.app",
        messagingSenderId: "656338565711",
        appId: "1:656338565711:web:395f9c7f846588b065883a"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();
    const postsRef = database.ref("posts");
    const usersRef = database.ref("users");

    let currentUser = null;

    /* ============================================================
        üî• Theme Definitions (Copied from Home.html)
    ============================================================ */
   const THEMES = {
        default: {
            name: 'üîÆ ‡∂¥‡∑ô‡∂ª‡∂±‡∑í‡∂∏‡∑í',
            bg: 'bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50',
            header: 'from-purple-600 via-pink-600 to-blue-600',
            preview: 'bg-gradient-to-br from-purple-500 to-pink-500',
            button: 'from-purple-600 via-pink-600 to-blue-600',
            avatarGradient: 'from-purple-500 via-pink-500 to-blue-500',
            settingBack: 'text-purple-600 hover:bg-purple-100', // Back button color classes
            settingBackBG: '#9333ea',
        },
        blue: {
            name: 'üîπ ‡∂±‡∑í‡∂Ω‡∑ä',
            bg: 'bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50',
            header: 'from-blue-600 via-indigo-600 to-purple-600',
            preview: 'bg-gradient-to-br from-blue-500 to-indigo-500',
            button: 'from-blue-600 via-indigo-600 to-purple-600',
            avatarGradient: 'from-blue-500 via-indigo-500 to-purple-500',
            settingBack: 'text-blue-600 hover:bg-blue-100',
            settingBackBG: '#3b82f6',
        },
        green: {
            name: '‚úÖ ‡∂ö‡∑ú‡∑Ö',
            bg: 'bg-gradient-to-br from-green-50 via-teal-50 to-cyan-50',
            header: 'from-green-600 via-teal-600 to-cyan-600',
            preview: 'bg-gradient-to-br from-green-500 to-teal-500',
            button: 'from-green-600 via-teal-600 to-cyan-600',
            avatarGradient: 'from-green-500 via-teal-500 to-cyan-500',
            settingBack: 'text-green-600 hover:bg-green-100',
            settingBackBG: '#10b981',
        },
        red: {
            name: 'üî¥ ‡∂ª‡∂≠‡∑î',
            bg: 'bg-gradient-to-br from-red-50 via-pink-50 to-orange-50',
            header: 'from-red-600 via-pink-600 to-orange-600',
            preview: 'bg-gradient-to-br from-red-500 to-orange-500',
            button: 'from-red-600 via-pink-600 to-orange-600',
            avatarGradient: 'from-red-500 via-pink-500 to-orange-500',
            settingBack: 'text-red-600 hover:bg-red-100',
            settingBackBG: '#ef4444',
        },
        yellow: {
            name: 'üåü ‡∂ª‡∂±‡∑ä‡∑Ä‡∂±‡∑ä',
            bg: 'bg-gradient-to-br from-yellow-50 via-amber-50 to-orange-50',
            header: 'from-yellow-600 via-amber-600 to-orange-600',
            preview: 'bg-gradient-to-br from-yellow-500 to-amber-500',
            button: 'from-yellow-600 via-amber-600 to-orange-600',
            avatarGradient: 'from-yellow-500 via-amber-500 to-orange-500',
            settingBack: 'text-yellow-600 hover:bg-yellow-100',
            settingBackBG: '#f59e0b',
        },
        dark: {
            name: '‚ö´ ‡∂Ö‡∂≥‡∑î‡∂ª‡∑î',
            bg: 'bg-gray-800', 
            header: 'bg-white', 
            preview: 'bg-gray-700 text-white',
            button: 'from-gray-600 via-gray-700 to-gray-800',
            avatarGradient: 'from-gray-700 via-gray-600 to-gray-500',
            settingBack: 'text-gray-400 hover:bg-gray-700 hover:text-white',
            settingBackBG: '#4b5563',
        },
        teal: {
            name: 'üíß ‡∂≠‡∑ö‡∂Ω‡∑ä',
            bg: 'bg-gradient-to-br from-teal-50 via-cyan-50 to-blue-50',
            header: 'from-teal-600 via-cyan-600 to-blue-600',
            preview: 'bg-gradient-to-br from-teal-500 to-cyan-500',
            button: 'from-teal-600 via-cyan-600 to-blue-600',
            avatarGradient: 'from-teal-500 via-cyan-500 to-blue-500',
            settingBack: 'text-teal-600 hover:bg-teal-100',
            settingBackBG: '#14b8a6',
        }
    };


    /* ============================================================
        üî• Theme Application (UPDATED)
    ============================================================ */
    function applyTheme() {
        const themeName = localStorage.getItem("appTheme") || "default";
        const theme = THEMES[themeName] || THEMES.default;
        
        document.body.className = 'min-h-screen ' + theme.bg;
        
        const headerTitle = document.getElementById('headerTitle');
        const backButton = document.querySelector('#appHeader button[onclick*="Home.html"]');

        // Update Header Title
        if (themeName === 'dark') {
             headerTitle.className = 'text-3xl font-bold bg-clip-text text-white';
        } else {
             // Remove existing gradient classes and apply new ones
             headerTitle.className = headerTitle.className.replace(/from-.*?to-.*?/g, '');
             headerTitle.className = 'text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r ' + theme.header;
        }

        // Update Back Button Color (p-2 text-xl text-gray-600 hover:text-purple-600 hover:bg-purple-100 rounded-full transition-colors)
        // Remove existing theme classes (purple-600, purple-100, gray-600)
        backButton.classList.remove('text-purple-600', 'hover:bg-purple-100', 'text-blue-600', 'hover:bg-blue-100', 'text-green-600', 'hover:bg-green-100', 'text-red-600', 'hover:bg-red-100', 'text-yellow-600', 'hover:bg-yellow-100', 'text-teal-600', 'hover:bg-teal-100', 'text-gray-400', 'hover:bg-gray-700', 'hover:text-white', 'text-gray-600');

        // Apply new theme classes
        backButton.classList.add(...theme.settingBack.split(' '));
    }


    /* ============================================================
        3. Theme Selector Logic (IMPLEMENTED)
    ============================================================ */
    function renderThemeOption(themeName, theme) {
        const currentTheme = localStorage.getItem('appTheme') || 'default';
        const isSelected = currentTheme === themeName;
        
        // The background color for dark theme preview should handle text color
        const previewClass = themeName === 'dark' ? theme.preview : theme.preview + ' text-white';
        
        return `
            <button onclick="selectTheme('${themeName}')" 
                class="relative block text-left p-3 rounded-2xl shadow-lg transition-all duration-300 transform hover:scale-[1.02] ${isSelected ? 'ring-4 ring-offset-2 ring-pink-400' : 'hover:ring-2 hover:ring-pink-300'}"
                style="background-color: white; border: 1px solid #fbcfe8;">
                <div class="w-full h-10 bg-gradient-to-br ${previewClass} rounded-lg mb-2 flex items-center justify-center text-lg font-bold">
                    ${theme.name.split(' ')[0]}
                </div>
                <p class="text-sm font-semibold text-gray-700">${theme.name.split(' ').slice(1).join(' ')}</p>
                <span class="text-xs text-pink-500 font-bold absolute top-2 right-2">${isSelected ? 'Active ‚úÖ' : ''}</span>
            </button>
        `;
    }

    function loadThemeSelectors() {
        const container = document.getElementById('themeContainer');
        container.innerHTML = '';
        
        // Use Object.keys(THEMES) to get all defined themes
        Object.keys(THEMES).forEach(themeName => {
            container.innerHTML += renderThemeOption(themeName, THEMES[themeName]);
        });
    }

    function selectTheme(themeName) {
        localStorage.setItem('appTheme', themeName);
        showNotification(`Theme ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∑Ö‡∑è: ${THEMES[themeName].name} ‚úÖ`);
        applyTheme(); // Apply to settings page immediately
        loadThemeSelectors(); // Re-render to show active status
    }
    /* ============================================================
        üî• Auth Check
    ============================================================ */
    auth.onAuthStateChanged(user => {
        if (!user) {
            window.location.href = "index.html"; // Redirect to login
            return;
        }
        currentUser = user;
        loadUserSettings();
        loadThemeSelectors();
        loadMyPosts(); // üî• Loading all posts and analysis
        applyTheme();
    });

    function signOutUser() {
        auth.signOut().then(() => {
            showNotification("Logout ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∂∫‡∑í.");
            window.location.href = "index.html";
        });
    }

    /* ============================================================
        1. Name/Avatar/Bio Change Functionality (UPDATED)
    ============================================================ */
    function loadUserSettings() {
        // üî• UPDATED: Fetch all user data
        usersRef.child(currentUser.uid).once('value', snap => {
            const userData = snap.val();
            const defaultName = currentUser.email.split("@")[0];

            document.getElementById('newNameInput').value = userData?.name || defaultName;
            
            // üî• NEW: Load Avatar and Bio
            document.getElementById('newAvatarInput').value = userData?.avatar || 'üë§'; 
            document.getElementById('newBioInput').value = userData?.bio || '';
        });
    }

    function updateUserName() {
        const newName = document.getElementById("newNameInput").value.trim();
        if (!newName) {
            return showNotification("‡∂±‡∂∏‡∂ö‡∑ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.");
        }

        usersRef.child(currentUser.uid).update({ name: newName })
        .then(() => {
            showNotification(`‡∂±‡∂∏ ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∑Ö‡∑è: ${newName} ‚úÖ`);
        })
        .catch(error => {
            showNotification("‡∂±‡∂∏ ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö Error. ‚ùå");
            console.error("Name update error:", error);
        });
    }

    // üî• NEW: updateUserAvatar()
    function updateUserAvatar() {
        const newAvatar = document.getElementById("newAvatarInput").value.trim().slice(0, 2); // Limit to 2 characters to safely handle single emoji
        if (!newAvatar) { 
            return showNotification("‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª Emoji ‡∂ë‡∂ö‡∂ö‡∑ä ‡∑Ñ‡∑ù ‡∂Ö‡∂ö‡∑î‡∂ª‡∂ö‡∑ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.");
        }

        usersRef.child(currentUser.uid).update({ avatar: newAvatar })
        .then(() => {
            showNotification(`Avatar ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∑Ö‡∑è: ${newAvatar} ‚úÖ`);
            document.getElementById("newAvatarInput").value = newAvatar; // Keep the single char/emoji in the box
        })
        .catch(error => {
            showNotification("Avatar ‡∑Ä‡∑ô‡∂±‡∑É‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö Error. ‚ùå");
            console.error("Avatar update error:", error);
        });
    }

    // üî• NEW: updateUserBio()
    function updateUserBio() {
        const newBio = document.getElementById("newBioInput").value.trim();
        
        usersRef.child(currentUser.uid).update({ bio: newBio })
        .then(() => {
            showNotification(`Bio ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ö‡∑Ö‡∑è. ‚úÖ`);
        })
        .catch(error => {
            showNotification("Bio ‡∂∫‡∑è‡∑Ä‡∂≠‡∑ä‡∂ö‡∑è‡∂Ω‡∑ì‡∂± ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö Error. ‚ùå");
            console.error("Bio update error:", error);
        });
    }


    /* ============================================================
        2. Theme Selection Functionality
    ============================================================ */
    function loadThemeSelectors() {
        const container = document.getElementById('themeContainer');
        container.innerHTML = '';
        const currentTheme = localStorage.getItem("appTheme") || "default";

        Object.keys(THEMES).forEach(key => {
            const theme = THEMES[key];
            const isSelected = key === currentTheme;

            const button = document.createElement('button');
            button.className = `theme-card p-3 rounded-xl shadow-lg text-white text-sm font-semibold transition-all hover:shadow-xl hover:scale-[1.02] active:scale-[0.98] ${theme.preview} ${isSelected ? 'ring-4 ring-offset-2 ring-pink-500' : ''}`;
            button.dataset.theme = key;
            button.textContent = theme.name;
            button.onclick = () => selectTheme(key);
            
            container.appendChild(button);
        });
    }

    function selectTheme(themeName) {
        localStorage.setItem("appTheme", themeName);
        applyTheme();
        showNotification(`${THEMES[themeName].name} Theme ‡∂ë‡∂ö ‡∂≠‡∑ù‡∂ª‡∑è‡∂ú‡∂≠‡∑ä‡∂≠‡∑è!`);
    }

    /* ============================================================
        3. My Posts View (Show Post Count and Reactions)
    ============================================================ */
    function loadMyPosts() {
        const myPostsFeed = document.getElementById("myPostsFeed");
        const loading = document.getElementById("loadingMyPosts");
        
        // üî• NEW: Add summary section if not exists
        let summaryDiv = document.getElementById("myPostsSummary");
        if (!summaryDiv) {
            // Find the parent div of the whole My Posts section
            const parentDiv = document.querySelector('.max-w-4xl.mx-auto.px-4.py-8 > div:nth-child(3)');
            summaryDiv = document.createElement('div');
            summaryDiv.id = 'myPostsSummary';
            summaryDiv.className = 'bg-blue-50 border-2 border-blue-200 rounded-xl p-5 mb-6 shadow-md fade-in';
            // Insert summary *before* the myPostsFeed
            // Note: Due to new sections, the nth-child index might change, using closest parent logic
            const targetParent = document.querySelector('.max-w-4xl.mx-auto.px-4.py-8').children[4]; // Targeting the My Posts section container
            targetParent.insertBefore(summaryDiv, myPostsFeed.parentNode.querySelector('h2').nextElementSibling); // Insert after the H2
        }
        summaryDiv.innerHTML = ''; // Clear existing summary

        loading.style.display = 'block';
        myPostsFeed.innerHTML = ''; // Clear existing post list

        postsRef.orderByChild("authorId").equalTo(currentUser.uid).once("value", snap => {
            loading.style.display = 'none';
            if (!snap.exists()) {
                myPostsFeed.innerHTML = '<p class="text-gray-500 text-center py-4">‡∂î‡∂∂ ‡∑Ä‡∑í‡∑É‡∑í‡∂±‡∑ä Posts ‡∂¥‡∑Ö ‡∂ö‡∂ª ‡∂±‡∑ê‡∂≠. üòî</p>';
                summaryDiv.innerHTML = '<p class="text-lg text-blue-700 font-bold">Posts ‡∑Ä‡∑í‡∑Å‡∑ä‡∂Ω‡∑ö‡∑Ç‡∂´‡∂∫: Posts ‡∂±‡∑ú‡∂∏‡∑ê‡∂≠.</p>';
                return;
            }

            const posts = [];
            let totalLikes = 0;
            let totalLaughs = 0;
            let totalFires = 0;
            let totalComments = 0;

            snap.forEach(s => {
                const post = { id: s.key, ...s.val() };
                posts.push(post);
                // Calculate totals for analysis
                totalLikes += post.reactionCounts?.like || 0;
                totalLaughs += post.reactionCounts?.laugh || 0;
                totalFires += post.reactionCounts?.fire || 0;
                totalComments += post.commentsCount || 0;
            });
            
            // Show newest posts first
            posts.reverse();
            
            // üî• NEW: Render Analysis Summary
            const totalPosts = posts.length;
            summaryDiv.innerHTML = `
                <h3 class="text-xl font-bold text-blue-800 mb-4">üìà ‡∂î‡∂∂‡∂ú‡∑ö Posts ‡∑Ä‡∑í‡∑Å‡∑ä‡∂Ω‡∑ö‡∑Ç‡∂´‡∂∫ (Analysis)</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div class="p-3 bg-blue-100 rounded-lg shadow-inner">
                        <p class="text-3xl font-bold text-blue-600">${totalPosts}</p>
                        <p class="text-sm text-blue-500">‡∂∏‡∑î‡∑Ö‡∑î Posts</p>
                    </div>
                    <div class="p-3 bg-red-100 rounded-lg shadow-inner">
                        <p class="text-3xl font-bold text-red-600">‚ù§Ô∏è ${totalLikes}</p>
                        <p class="text-sm text-red-500">‡∂∏‡∑î‡∑Ö‡∑î Likes</p>
                    </div>
                    <div class="p-3 bg-yellow-100 rounded-lg shadow-inner">
                        <p class="text-3xl font-bold text-yellow-600">üòÇ ${totalLaughs}</p>
                        <p class="text-sm text-yellow-500">‡∂∏‡∑î‡∑Ö‡∑î Laughs</p>
                    </div>
                    <div class="p-3 bg-green-100 rounded-lg shadow-inner">
                        <p class="text-3xl font-bold text-green-600">üí¨ ${totalComments}</p>
                        <p class="text-sm text-green-500">‡∂∏‡∑î‡∑Ö‡∑î Comments</p>
                    </div>
                </div>
            `;
            
            // Render individual posts
            posts.forEach(post => {
                renderMyPost(post);
            });
        });
    }

    // üî• UPDATED: renderMyPost function for clearer analytics display
    function renderMyPost(post) {
        const myPostsFeed = document.getElementById("myPostsFeed");
        const div = document.createElement("div");
        // Enhanced styling for list items
        div.className = "bg-white rounded-xl p-5 border border-gray-100 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-[1.01]";

        const likeCount = post.reactionCounts?.like || 0;
        const laughCount = post.reactionCounts?.laugh || 0;
        const fireCount = post.reactionCounts?.fire || 0;
        const totalReactions = likeCount + laughCount + fireCount;

        div.innerHTML = `
            <p class="text-base text-gray-800 font-medium mb-3 line-clamp-3">${post.content}</p>
            <div class="flex items-center justify-between text-sm pt-3 mt-3 border-t-2 border-gray-100">
                <div class="flex items-center space-x-4 text-gray-600 font-semibold">
                    <span title="‡∂∏‡∑î‡∑Ö‡∑î Reactions ‡∂ú‡∂´‡∂±" class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-bold">‚ú® Total Reactions: ${totalReactions}</span>
                    <span title="Likes ‡∂ú‡∂´‡∂±" class="text-red-500">‚ù§Ô∏è ${likeCount}</span>
                    <span title="Laughs ‡∂ú‡∂´‡∂±" class="text-yellow-500">üòÇ ${laughCount}</span>
                    <span title="Fire ‡∂ú‡∂´‡∂±" class="text-orange-500">üî• ${fireCount}</span>
                    <span title="Comments ‡∂ú‡∂´‡∂±" class="text-blue-500">üí¨ ${post.commentsCount || 0}</span>
                </div>
                <button onclick="deletePost('${post.id}')"
                    class="ml-auto text-red-500 hover:text-red-700 p-2 rounded-lg hover:bg-red-50 transition">
                    üóëÔ∏è ‡∂∏‡∂ö‡∂±‡∑ä‡∂±
                </button>
            </div>
        `;
        myPostsFeed.appendChild(div);
    }
    
    function deletePost(id) {
        if (!confirm("‡∂∏‡∑ô‡∂∏ ‡∂¥‡∑ù‡∑É‡∑ä‡∂ß‡∑ä ‡∂ë‡∂ö ‡∂∏‡∂ö‡∂±‡∑ä‡∂±‡∂Ø?")) return;

        postsRef.child(id).once("value").then(s => {
            if (s.val().authorId !== currentUser.uid) {
                showNotification("‡∂î‡∂∂‡∂ß ‡∂∏‡∑ô‡∂ö ‡∂∏‡∑ê‡∂ö‡∑î‡∂∏‡∂ß ‡∂Ö‡∑Ä‡∑É‡∂ª ‡∂±‡∑ê‡∑Ñ‡∑ê");
                return;
            }
            postsRef.child(id).remove().then(() => {
                showNotification("‡∂¥‡∑ù‡∑É‡∑ä‡∂ß‡∑ä ‡∂ë‡∂ö ‡∂∏‡∂ö‡∂± ‡∂Ω‡∂Ø‡∑ì üóëÔ∏è");
                loadMyPosts(); // Refresh the list
            });
        });
    }

    /* ============================================================
        üî• Helpers
    ============================================================ */
    function showNotification(text) {
        const box = document.getElementById("notificationBox");
        box.textContent = text;
        box.classList.remove('hidden');
        box.classList.add('fade-in');
        
        setTimeout(() => {
            box.classList.remove('fade-in');
            box.classList.add('hidden');
        }, 3000);
    }

    </script>
</body>
</html>
